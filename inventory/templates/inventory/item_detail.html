{% extends "base.html" %}

{% block title %}{{ item.name }} â€” MVPH Inventory{% endblock %}

{% block content %}
<div class="detail-header">
  <h1>{{ item.name }}</h1>
  <div class="detail-actions">
    <a href="{% url 'inventory:item_update' item.pk %}" class="btn btn-primary">Edit</a>
    <a href="{% url 'inventory:item_delete' item.pk %}" class="btn btn-danger">Delete</a>
  </div>
</div>

<div class="detail-card">
  <dl>
    <dt>Category</dt>
    <dd>{{ item.get_category_display }}</dd>

    <dt>Subcategory</dt>
    <dd>{{ item.subcategory_display }}</dd>

    {% if item.category == "ingredient" %}
    <dt>Earmarked For</dt>
    <dd>{% with recipes=item.earmarked_for.all %}{% if recipes %}{% for r in recipes %}{{ r.name }}{% if not forloop.last %}, {% endif %}{% endfor %}{% else %}None{% endif %}{% endwith %}</dd>
    {% endif %}

    <dt>Quantity on Hand</dt>
    <dd>
      {{ item.quantity_on_hand }} {{ item.get_unit_of_measure_display }}
      {% if item.stock_status == "reorder" %}
        <span class="badge badge-danger">Order</span>
      {% elif item.stock_status == "low" %}
        <span class="badge badge-warning">Low</span>
      {% else %}
        <span class="badge badge-ok">OK</span>
      {% endif %}
    </dd>

    <dt>Reorder Point</dt>
    <dd>{{ item.reorder_point }} {{ item.get_unit_of_measure_display }}</dd>

    {% if item.description %}
    <dt>Description</dt>
    <dd>{{ item.description }}</dd>
    {% endif %}

    {% if item.notes %}
    <dt>Notes</dt>
    <dd>{{ item.notes }}</dd>
    {% endif %}

    <dt>Created</dt>
    <dd>{{ item.created_at|date:"N j, Y g:i a" }}{% if item.created_by %} by {{ item.created_by.username }}{% endif %}</dd>

    <dt>Updated</dt>
    <dd>{{ item.updated_at|date:"N j, Y g:i a" }}{% if item.updated_by %} by {{ item.updated_by.username }}{% endif %}</dd>
  </dl>
</div>

<div class="history-section">
  <button
    class="btn"
    hx-get="{% url 'inventory:item_history' item.pk %}"
    hx-target="#history-content"
    hx-swap="innerHTML"
  >Show History</button>
  <div id="history-content"></div>
</div>

<a href="{% url 'inventory:item_list' %}" class="back-link">&larr; Back to list</a>
{% endblock %}
